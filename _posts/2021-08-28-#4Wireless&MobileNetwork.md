---
layout: post
title: "무선 네트워크"
categories: 네트워크
author: bn-tw2020
---
* content
{:toc}


## 무선 네트워크 

* 점점 기술이 발전하면서 유선에서 무선 링크로 존재하게 되었다.

* 무선 링크에서의 사용되는 MAC protocol을 정리하는 것이다.





* 유선 이더넷을 사용했을 때는 하나의 브로드캐스 미디어에서 공유해서 생긴 문제엿다면,

  무선에서도 공기라는 하나의 공유된 미디어를 통해 생기는 충돌이 발생하기 때문에 어떻게 해결할 수 있을까이다.

* 무선 링크의 특성의 차이가 존재한다.

* Wireless와 Mobility이다.

* Wireless는 선이 없다라는 것이고, Mobility는 네트워크에 연결된 상태에서 다른 네트워크를 넘나드는 이동이 있는 것이다.


## Wireless

<img width="578" alt="스크린샷 2021-08-28 오후 6 29 19" src="https://user-images.githubusercontent.com/66770613/131213330-5a63c034-fc5f-46ec-9a98-28d9fc0efe1e.png">  

* 무선 네트워크, 무선 인터넷은 어디가 무선이라는 이야기이다.

* 노트북이나 휴대폰을 통해 구글서버에 접속한다고 해보자.

  가기까지의 모든 과정이 무선인가? 아니다! 한 hop까지가 무선이다.

  즉, 한 hop을 어떻게 무선으로 갈 것인가에 집중해야한다. 나머지 부분은 유선이기에 전글들을 이해하면 된다.

<img width="694" alt="스크린샷 2021-08-28 오후 6 32 42" src="https://user-images.githubusercontent.com/66770613/131213412-f6bd81f5-317c-47e6-b5c3-831da636cfb5.png">  

* 흔히 우리가 알고 있는 Wi-Fi는 전송 거리는 짧은 것들이다. 802.15, 802.11b, 802.11n ... 

  점점 발전은 하고 있지만, 데이터 속도는 좋아지는데 전송 반경은 짧다. 실내에서 주로 사용하게 된다.

* 전송 반경이 긴 것들은 2G, 2.5G, 3G, 4G, 5G로 Cellular Internet에서 사용한다.

* 유선 이더넷에서 신호가 케이블을 통해 외부의 잡음에 차단된채로 신호가 전달된다. 그래서 일정하게 신호 세기가 전해진다.

  무선은 거리가 늘어나면서 신호세기가 줄어든다. 외부로부터 잡음이 많이 연결된다.

* a, b, c의 host가 있는데 무선 전송의 전송 반경이 100m라고 해보자.

  a와 b는 80m, b와 c는 80m a와 c는 160m라고 하자. a와 b는 서로 데이터를 들을 수 있으며, b와 c도 서로 들을 수 있다.

  하지만, a와 c는 서로 들을 수가 없다. 그래서 통신하는 사람이 없다고 생각해서 데이터를 전송할 수 있는데 사실 상 충돌이 일어난다.
  
  그래서 유선에서 사용하던 CSMA/CD를 사용할 수가 없다. 이 문제를 Hidden terminal problem이라고 부르게된다.

  <img width="348" alt="스크린샷 2021-08-28 오후 6 43 13" src="https://user-images.githubusercontent.com/66770613/131213709-be6499e7-f4d1-44f5-a4de-3fbe1a22997f.png">  

* 또 다른,무선 링크의 가장 큰 특징과 문제점은 충돌 감지가 불가능하다.

  a가 이야기하면 b가 a의 전송반경 내에 있어도 들리지 않는다. a가 말하면 엄청 크게 들리지만 반경이 넓어질수록 소리가 작게 들리기 때문이다.

  즉, 내 자신의 목소리가 더 크게 들리기 때문이다. 무선에서는 거리가 커질수록 신호 세기가 약해진다는 것이다.

  위의 2가지 특성을 조합해보면 충돌은 하는데 충돌 감지를 못하게 된다.

* 그럼 무선 네트워크에서는 어떤 프로토콜을 사용하는 것인가?


## WiFi

* WiFi의 정식 명칭은 IEEE 802.11x이다. 읽기 어려워서 상표권 용어로 WiFi라고 부르게 된다. Wi-Fi는 Wireless Fidelity의 줄임말이다.

* 802.11b 802.11a 802.11g 802.11n 순으로 data rate가 진화해가고 있다.

* 액세스 포인트(AP)가 있고 주변 기기와 연결되어 있는 구조이다. 

  IEEE 802.11 무선 근거리 통신망과 연결되는 모든 장치를 구성하는 집합을 BSS(Baic Service Set)이라고 한다.

* 처음 노트북을 키면 주변의 BSS와 연결될 것이다. 모든 AP들은 주기적으로 자기 자신의 정보를 브로드캐스트한다.

  AP는 비콘 프레임에 정보를 담아서 보내주게 된다.

  그럼 호스트들이 판단하여 연결하게 된다. passive scan이라고 부른다.

## WiFi의 MAC Protocol

* WiFi는 어떤 MAC protocol을 이용할까?

* WiFi는 위에서 말한대로 충돌는 하는데 감지를 못한다.

  링크 계층에서는 ACK가 오지 않는다. 스스로 충돌을 감지하기 떄문이다. 무선 방식을 사용하는 곳을 충돌 감지가 안되기 때문에

  상대방이 잘왔는지 알려줘야한다. ACK를 활용해야 한다.

  지금 말한 ACK는 TCP에서의 ACK랑 다른 개념이다. TCP에서는 end-to-end의 ACK이지만, 

  링크에서는 한 hop 사이의 ACK이다.

  그래서, 무선 네트워크에서의 MAC Protocol은 **CSMA/CA** 이다.


## CSMA/CA

  * 처음에 보낼 데이터가 있으면 sender가 carrier sense을 해본다.
  
    누군가 말하고 있으면 보내지 않고, 조용해질 때까지 기다린다.

    기다리는 시간은 binary backoff으로 랜덤한 시간을 골라서 기다렸다가 보내게된다.

    receiver는 데이터를 받으면 정해진 시간만큼 기다린다음 그에 해당하는 ACK를 보내준다.

    만약 ACK가 오지 않으면 문제가 있음을 판단하고 재전송 준비를 한다.

    

## CSMA/CD와 CSMA/CA

* 유선 네트워크에서는 충돌음 감지하게 되면 바로 멈추게 된다.

  무선 네트워크는 멈추는 개념이 없다. 충돌을 감지할 수가 없기 때문이다.

  그래서 한번에 보내면 폭주기관차 마냥 데이터를 보낸다.

  유선은 낭비되는 시간이 적은데 무선은 낭비되는 시간이 많아진다.


## RTS-CTS

* CSMA/CA는 충돌에 대한 피해를 줄이려고 하지 않는다. ACK가 올 때까지 계속해서 데이터를 보내주기 때문이다. 

  충돌을 줄이기 위해 개선된 것이 RTS-CTS라는 특별한 control frame을 추가하여 충돌을 줄인다.

* RTS는 ready to send 주변 사람들에게 나 보낼 데이터가 있다고 알려주는 것이다.

  CTS는 데이터를 보내라고 허락해주는 clear to send이다.

* CSMA/CA는 충돌이 나면 다 날라간다. 충돌에 대한 위험성이 있는데 데이터를 계속 보내는 것이다.

  그래서 데이터를 먼저 보내는 것이 아니라 작은 정보를 보내서 보내도 될지 확인하는 것이다.

```
동작과정

1. A, AP, B가 있다고 가정해보자.
   B는 AP에게 보낼 데이터가 있다.

2. 처음에 carrier sense을 하고 조용하니 보낼 수 있다. 하지만 충돌날수도 있으니 바로 보내게되면 데이터가 다 날라간다.

3. 그래서 carrier sense을 하고나서 보낼 데이터가 있다고 작은 사이즈의 RTS의 control frame을 보낸다.

4. A가 보낼 데이터가 있어서 RTS를 보낸다.

5. 둘이 동시에 보내게되면 충돌이 일어나서 AP는 쓰레기 값으로 인식된다.

6. 원래는 AP가 값을 보내라는 응답으로 CTS를 보내준다. 하지만 현재의 경우는 쓰레기값이여서 가만히 있는다.
   여기서 RTS의 충돌은 크기 작아서 전보다 훨씬 좋은 현상이다.

7. A, B는 CTS가 오지 않았기 때문에 충돌났다고 판단하여 binary backoff해서 기다리게 된다.

8. A의 backoff 시간이 더 짧아서 A가 carrier sense을 하고나서 RTS를 보낸다. RTS는 브로드캐스트로 퍼지게되며
   주변 기기들은 아 RTS을 보고 아 이친구가 얼마만큼 어느정도를 쓰려고 하는 구나라고 판단을 한다.

9. AP는 받고 응답으로 CTS을 브로드캐스트로 보내주게 된다. CTS 메시지에서도 A가 얼마만큼 데이터를 사용하는지 알려주게된다.

10. A는 그래서 데이터를 안전하게 전송하게 되고 AP는 A에게 ACK 메시지를 보내주게된다.
```

<img width="621" alt="스크린샷 2021-08-28 오후 8 05 50" src="https://user-images.githubusercontent.com/66770613/131215975-bf4b26ef-6e14-4c80-8486-d5df0ca50da6.png">  
