---
layout: post
title: "샤딩(Sharding)"
categories: DB
author: bn-tw2020
---
* content
{:toc}


## 샤딩의 필요성

* 서비스의 크기가 커지고 DB에 저장하는 데이터의 규모 또한 대용량화 되면서, 기존에 사용하는 DB시스템

  의 **용량의 한계와 성능의 저하** 를 가져오게 되었다.

* 너무 큰 table이 들어가면서 용량과 성능 측면에서 많은 이슈가 발생하게 되었고, 

  이런 이슈를 해결하기 위한 방법으로 **샤딩**을 사용하는 것이 좋다.





## 샤딩과 수평분할

* 샤딩은 수평분할 방식과 비슷하다.

* 수평 분할은 스키마가 같은 데이터를 2개 이상의 테이블에 나누어 저장하는 방식이다.

* 데이터베이스를 샤딩하게 되면 기존에 하나로 구성될 스카마를 다수의 복제본으로 구성해서 샤드에 어떤 데이터가 저장될지

  샤드 키를 기준으로 분리합니다.

* 보통 **수평분할** 을 한다면 하나의 데이터베이스 안에서 이루어지는 경우를 지칭합니다.

* **샤딩**은 다른 데이터베이스로 데이터를 수평 분할 방식으로 분산 저장하고 조회하는 방법입니다.

  e.g `주민` 테이블이 여러 DB에 있을 때, 서현동 주민에 대한 정보는 A DB에 
  
  정자동 주민에 대한 정보는 B DB에 저장되도록 하는 방식을 말한다.

* 여러 데이터베이스를 대상으로 작업하기 때문에 경우에 따라서 기능에 제약(JOIN)이 존재한다.

  일관성과 복제 등에서 불리하다.

* 예전의 샤딩은 애플리케이션 레벨에서 구현하는 경우가 많았지만,

  최근에는 이를 플랫폼 차원에서 제공하려고 한다.


## 샤딩 수행 시 고려할 사항

* 데이터 재분배

  * 서비스 정지 없이 데이터베이스 스키마 및 서버 설계가 필요하다.

* 샤딩 조인

  *  샤딩 DB 간에 JOIN이 불가능하기 때문에 역정규화를 감수해야 한다.

* 샤드 간 트랜잭션

  * 하나의 트랜잭션에서 2개 이상의 샤드에 접근할 수 없기 떄문에 Global Transcation을 사용해야 한다.


## 샤딩의 한계

* 샤딩의 대표적인 제약 사항

```
1. 두 개 이상의 샤드에 대한 JOIN 연산을 할 수 없다.
2. auto increment 등은 샤드별로 달라질 수 있다.
3. last_insert_id()값은 유효하지 않다.
4. shard key column 값은 update하면 안된다(delete - insert 사용해야 한다.)
5. 하나의 트랜잭션에서 2개 이상의 샤드에 접근할 수 없다.
```



## Reference 

[샤딩과 파티셔닝의 차이점](https://galid1.tistory.com/797)

[샤딩](https://d2.naver.com/helloworld/14822)
